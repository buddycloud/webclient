<!doctype html>
<html lang="en">
<head>
  <title>Streams</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen">
  <script src="../js/vendor/jquery.js"></script>
  <script src="../js/vendor/modernizr.js"></script>
</head>
<body>
  <div class="sidebar">
    <div class="personal channel">
      <div class="avatar" style="background-image: url(avatars/user1.jpg)">
        <span class="channelpost counter">2</span>
        <span class="message counter">2</span>
      </div>
      <div class="info">
        <span class="owner">Felix Niklas</span>
        <span class="status">Aww yeah, Mountain Lion rocks</span>
      </div>
      <div class="settings noSelect">
        <div class="popup">
          <div class="centered vertical">
            <div class="arrow"></div>
            <ul>
              <li class="newChannel"><a href="editChannel.html">Create Topic Channel</a>
              <li class="preferences"><a href="preferences.html">Preferences</a>
              <li class="logout">Logout
            </ul>
          </div>
        </div>
      </div>
    </div>
    <nav class="actionBar clearfix">
      <button class="discover"><span>Find Channels</span></button>
    </nav>
    <div class="channels" class="antiscroll-wrap">
      <div class="antiscroll-inner scrollHolder">
        <div class="channel selected">
          <div class="avatar" style="background-image: url(avatars/user2.jpg)">
            <span class="channelpost counter">2</span>
          </div>
          <div class="info">
            <span class="owner">Vera Maier</span>
            <span class="status">What a wonderful day</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/channel2.jpg)">
            <span class="channelpost counter admin">1</span>
          </div>
          <div class="info">
            <span class="owner">Moviefans</span>
            <span class="status">Harry Potter, tonight!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/channel3.jpg)">
            <span class="channelpost counter admin">1</span>
          </div>
          <div class="info">
            <span class="owner">On the Box</span>
            <span class="status">You gonna love the new Dexter episodes</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(../img/topic-50px.jpg)">
            <span class="channelpost counter">2</span>
          </div>
          <div class="info">
            <span class="owner">Lolcats</span>
            <span class="status">I can haz your nose?</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(../img/personal-50px.jpg)">
          </div>
          <div class="info">
            <span class="owner">Martin Rackel</span>
            <span class="status">working on the webgl project</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(../img/topic-50px.jpg)">
          </div>
          <div class="info">
            <span class="owner">music<span class="domain">@buddycloud.com</span></span>
            <span class="status">New Foo Fighter Album online - check it out!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/user7.jpg)">
          </div>
          <div class="info">
            <span class="owner">verena<span class="domain">@buddycloud.com</span></span>
            <span class="status">test's are over - party!!!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/channel7.jpg)">
          </div>
          <div class="info">
            <span class="owner">fans<span class="domain">@steam.com</span></span>
            <span class="status">the cake is a lie!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/channel8.jpg)">
          </div>
          <div class="info">
            <span class="owner">cave<span class="domain">@minecraft.com</span></span>
            <span class="status">Buy minecraft - now!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(../img/personal-50px.jpg)">
            <span class="channelpost counter">2</span>
          </div>
          <div class="info">
            <span class="owner">steve<span class="domain">@buddycloud.com</span></span>
            <span class="status">all your base belongs to us</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/channel2.jpg)">
            <span class="channelpost counter admin">1</span>
          </div>
          <div class="info">
            <span class="owner">moviefans<span class="domain">@buddycloud.com</span></span>
            <span class="status">Harry Potter, tonight!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/channel3.jpg)">
            <span class="channelpost counter admin">1</span>
          </div>
          <div class="info">
            <span class="owner">on-the-box<span class="domain">@bbc.co.uk</span></span>
            <span class="status">You gonna love the new Dexter episodes</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/channel4.jpg)">
            <span class="channelpost counter">2</span>
          </div>
          <div class="info">
            <span class="owner">lolcats<span class="domain">@buddycloud.com</span></span>
            <span class="status">I can haz your nose?</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/user4.jpg)">
          </div>
          <div class="info">
            <span class="owner">martin<span class="domain">@buddycloud.com</span></span>
            <span class="status">working on the webgl project</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/channel6.jpg)">
          </div>
          <div class="info">
            <span class="owner">music<span class="domain">@buddycloud.com</span></span>
            <span class="status">New Foo Fighter Album online - check it out!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/user7.jpg)">
          </div>
          <div class="info">
            <span class="owner">verena<span class="domain">@buddycloud.com</span></span>
            <span class="status">test's are over - party!!!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/channel7.jpg)">
          </div>
          <div class="info">
            <span class="owner">fans<span class="domain">@steam.com</span></span>
            <span class="status">the cake is a lie!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/channel8.jpg)">
          </div>
          <div class="info">
            <span class="owner">cave<span class="domain">@minecraft.com</span></span>
            <span class="status">Buy minecraft - now!</span>
          </div>
        </div>
      </div><!-- /antiscroll-inner -->
    </div><!-- /channels -->
  </div>
  <div class="content">
    <div class="channelView personal clearfix">
      <header class="channelHeader justify">
        <div class="avatar" style="background-image: url(avatars/user2_big.jpg)"></div>
        <div class="flex titleText">
          <h2 class="owner" data-editmode="singleLine">Vera Maier</h2>
          <div class="about" data-editmode="multiLine">I'm Vera, I love to cook, I love clothes and most of all, I love my boyfriend.</div>
        </div>
        <nav class="inChannel">
          <!--<span class="messages button newMessage">
            <span class="holder">Messages</span><span class="message counter">2</span>
          </span>-->
          <span class="channel button">
            <span class="holder">Channel</span>
          </span>
          <span class="hidden save button">Save</span>
          <!--<span class="edit button">Edit</span>-->
          <span class="unfollow button">Unfollow</span>
        </nav>
        <a href="http://www.buddycloud.com" id="poweredby">powered by buddycloud</a>
      </header>
      <div class="centered start">
        <section class="stream clearfix">
          <section class="newTopic">
            <img class="avatar" src="avatars/user1.jpg" />
            <div class="holder">
              <textarea placeholder="New Topic..."></textarea>
              <div class="controls clearfix">
                <div class="hint">ctrl + enter to post</div>
                <div class="button callToAction createComment">Post</div>
              </div>
            </div>
          </section>
          <!-- this produces some weird bug - some content below
      it gets lost when this is visible -->
      	  <div class="notifications">
      	    <article class="notification">
      	      <section>
                <img class="avatar" src="avatars/user4.jpg" />
                <div class="info">
      	          <span class="name">martin<span class="domain">@buddycloud.com</span></span>
                  <p>wants to follow this channel.</p>
                  <span class="granted">started following this channel.</span>
                  <span class="denied">was denied to follow this channel.</span>
                </div>
                <div class="controls">
                  <div class="button small negative light">Deny</div>
                  <div class="button small positive light">Grant Martin to join</div>
                </div>
              </section>
      	    </article>
      	  </div>
          <section class="posts">
            <article class="post noComments">
              <section class="opener owner">
                <img class="avatar" src="avatars/user2.jpg" />
                <div class="usermeta">
                  <div class="name">Vera Maier</div>
                  <div class="jid">vera@buddycloud.com</div>
                </div>
                <div class="postmeta">
                  <time class="ago" data-strftime="%d.%m.%Y %H:%M" data-strftitle="%A %d %B %Y %H:%M" datetime="2011-06-06T05:06:00.000Z" title="5:06pm 06.06.2011">1 minute</time>
                  <button class="flat delete button" title="Delete Post">✖</button>
                  <button class="flat cancel-delete button" title="Don't Delete Post">no!</button>
                </div>
                <span class="name">vera<span class="domain">@buddycloud.com</span></span><span class="location">from Home</span>
                <p>So it looks like Andi finally joined: <a class="internal" href="buddycloud.com/andi@buddycloud.com">andi<span class="domain">@buddycloud.com</span></a></p>
              </section>
              <section class="comments">
                <section class="answer">
                  <img class="avatar" src="avatars/user1.jpg" />
                  <div class="holder">
                    <textarea placeholder="comment"></textarea>
                    <div class="controls clearfix">
                      <div class="hint">ctrl + enter to post</div>
                      <div class="button callToAction createComment">Post</div>
                    </div>
                  </div>
                </section>
              </section>
            </article>
            <article class="post noComments">
              <section class="opener owner">
                <img class="avatar" src="avatars/user2.jpg" />
                <div class="usermeta">
                  <div class="name">Vera Maier</div>
                  <div class="jid">vera@buddycloud.com</div>
                </div>
                <div class="postmeta">
                  <time class="ago" data-strftime="%d.%m.%Y %H:%M" data-strftitle="%A %d %B %Y %H:%M" datetime="2011-06-06T05:06:00.000Z" title="5:06pm 06.06.2011">5 minutes</time>
                  <button class="flat delete button" title="Delete Post">✖</button>
                </div>
                <span class="name">vera<span class="domain">@buddycloud.com</span></span><span class="location">from Home</span>
                <p>I'm a sociopath; there's not much he can do for me. I have a dark side, too. I will not kill my sister. I will not kill my sister. I will not kill my sister. He taught me a code. To survive. Under normal circumstances, I'd take that as a compliment. I'm generally confused most of the time.</p>
              </section>
              <section class="comments">
                <section class="answer">
                  <img class="avatar" src="avatars/user1.jpg" />
                  <div class="holder">
                    <textarea placeholder="comment"></textarea>
                    <div class="controls clearfix">
                      <div class="hint">ctrl + enter to post</div>
                      <div class="button callToAction createComment">Post</div>
                    </div>
                  </div>
                </section>
              </section>
            </article>
            <article class="post">
              <section class="opener owner">
                <img class="avatar" src="avatars/user2.jpg" />
                <div class="usermeta">
                  <div class="name">Vera Maier</div>
                  <div class="jid">vera@buddycloud.com</div>
                </div>
                <div class="postmeta">
                  <time class="ago" data-strftime="%d.%m.%Y %H:%M" data-strftitle="%A %d %B %Y %H:%M" datetime="2011-06-06T05:06:00.000Z" title="5:06pm 06.06.2011">3 days</time>
                  <button class="flat delete button" title="Delete Post">✖</button>
                </div>
                <span class="name">vera<span class="domain">@buddycloud.com</span></span><span class="location">from Campus Library</span>
                <p>Pretend. You pretend the feelings are there, for the world, for the people around you.</p>
              </section>
              <section class="comments">
                <section class="comment moderator">
                  <img class="avatar" src="avatars/user6.jpg" />
                  <div class="usermeta">
                    <div class="name">Elisabeth Smith</div>
                    <div class="jid">lisa@buddycloud.com</div>
                  </div>
                  <div class="postmeta">
                    <time data-strftime="%d.%m.%Y %H:%M" data-strftitle="%A %d %B %Y %H:%M" datetime="2011-06-06T05:06:00.000Z" title="5:06pm 06.06.2011">3 days</time>
                  <button class="flat delete button" title="Delete Post">✖</button>
                  </div>
                  <span class="name">mona<span class="domain">@buddycloud.com</span></span><span class="location">from Cafe Extra</span>
                  <p>Who knows? Maybe one day they will be. I like seafood.</p>
                </section>
                <section class="comment">
                  <img class="avatar" src="avatars/user7.jpg" />
                  <div class="postmeta">
                    <time data-strftime="%d.%m.%Y %H:%M" data-strftitle="%A %d %B %Y %H:%M" datetime="2011-06-06T05:06:00.000Z" title="5:06pm 06.06.2011">3 days</time>
                  <button class="flat delete button" title="Delete Post">✖</button>
                  </div>
                  <span class="name">verena<span class="domain">@buddycloud.com</span></span><span class="location">from Home</span>
                  <p>Finding a needle in a haystack isn't hard when every straw is computerized. I'm really more an apartment person.</p>
                </section>
                <section class="comment">
                  <img class="avatar" src="avatars/user11.jpg" />
                  <div class="postmeta">
                    <time data-strftime="%d.%m.%Y %H:%M" data-strftitle="%A %d %B %Y %H:%M" datetime="2011-06-06T05:06:00.000Z" title="5:06pm 06.06.2011">3 days</time>
                  <button class="flat delete button" title="Delete Post">✖</button>
                  </div>
                  <span class="name">betty<span class="domain">@buddycloud.com</span></span><span class="location">from Donau</span>
                  <p>I feel like a jigsaw puzzle missing a piece. And I'm not even sure what the picture should be.</p>
                </section>
                <section class="comment">
                  <img class="avatar" src="avatars/user13.jpg" />
                  <div class="postmeta">
                    <time data-strftime="%d.%m.%Y %H:%M" data-strftitle="%A %d %B %Y %H:%M" datetime="2011-06-06T05:06:00.000Z" title="5:06pm 06.06.2011">3 days</time>
                  <button class="flat delete button" title="Delete Post">✖</button>
                  </div>
                  <span class="name">daniel<span class="domain">@buddycloud.com</span></span><span class="location">from Home</span>
                  <p>I'm going to tell you something that I've never told anyone before.</p>
                </section>
                <section class="answer">
                  <img class="avatar" src="avatars/user1.jpg" />
                  <div class="holder">
                    <textarea placeholder="comment"></textarea>
                    <div class="controls clearfix">
                      <div class="hint">ctrl + enter to post</div>
                      <div class="button callToAction createComment">Post</div>
                    </div>
                  </div>
                </section>
              </section>
            </article>
            <article class="post">
              <section class="opener">
                <img class="avatar" src="avatars/user2.jpg" />
                <div class="postmeta">
                  <time data-strftime="%d.%m.%Y %H:%M" data-strftitle="%A %d %B %Y %H:%M" datetime="2011-06-06T05:06:00.000Z" title="5:06pm 06.06.2011">3 days</time>
                  <button class="flat delete button" title="Delete Post">✖</button>
                </div>
                <span class="name">vera<span class="domain">@buddycloud.com</span></span><span class="location">from Munich</span>
                <p>Pretend. You pretend the feelings are there, for the world, for the people around you.</p>
              </section>
              <section class="comments">
                <section class="comment">
                  <img class="avatar" src="avatars/user3.jpg" />
                  <div class="postmeta">
                    <time data-strftime="%d.%m.%Y %H:%M" data-strftitle="%A %d %B %Y %H:%M" datetime="2011-06-06T05:06:00.000Z" title="5:06pm 06.06.2011">3 days</time>
                  <button class="flat delete button" title="Delete Post">✖</button>
                  </div>
                  <span class="name">Tom</span><span class="location">from Men's Cave</span>
                  <p>Who knows? Maybe one day they will be. I like seafood.</p>
                </section>
                <section class="comment">
                  <img class="avatar" src="avatars/user5.jpg" />
                  <div class="postmeta">
                    <time data-strftime="%d.%m.%Y %H:%M" data-strftitle="%A %d %B %Y %H:%M" datetime="2011-06-06T05:06:00.000Z" title="5:06pm 06.06.2011">3 days</time>
                  <button class="flat delete button" title="Delete Post">✖</button>
                  </div>
                  <span class="name">gero<span class="domain">@buddycloud.com</span></span><span class="location">from Regensburg</span>
                  <p>Finding a needle in a haystack isn't hard when every straw is computerized. I'm really more an apartment person.</p>
                </section>
                <section class="comment">
                  <img class="avatar" src="avatars/user2.jpg" />
                  <div class="postmeta">
                    <time data-strftime="%d.%m.%Y %H:%M" data-strftitle="%A %d %B %Y %H:%M" datetime="2011-06-06T05:06:00.000Z" title="5:06pm 06.06.2011">3 days</time>
                  <button class="flat delete button" title="Delete Post">✖</button>
                  </div>
                  <span class="name">vera<span class="domain">@buddycloud.com</span></span><span class="location">from Munich</span>
                  <p>I feel like a jigsaw puzzle missing a piece. And I'm not even sure what the picture should be.</p>
                </section>
                <section class="unread comment">
                  <img class="avatar" src="avatars/user12.jpg" />
                  <div class="postmeta">
                    <time data-strftime="%d.%m.%Y %H:%M" data-strftitle="%A %d %B %Y %H:%M" datetime="2011-06-06T05:06:00.000Z" title="5:06pm 06.06.2011">3 days</time>
                  <button class="flat delete button" title="Delete Post">✖</button>
                  </div>
                  <span class="name">sebastian<span class="domain">@buddycloud.com</span></span><span class="location">from Passau</span>
                  <p>I'm going to tell you something that I've never told anyone before.</p>
                </section>
                <section class="answer">
                  <img class="avatar" src="avatars/user1.jpg" />
                  <div class="holder">
                    <textarea placeholder="comment"></textarea>
                    <div class="controls clearfix">
                      <div class="hint">ctrl + enter to post</div>
                      <div class="button callToAction createComment">Post</div>
                    </div>
                  </div>
                </section>
              </section>
            </article>
          </section>
          <p class="loader">
            <span class="spinner"></span>
          </p>
        </section><!-- /stream -->
        <div class="channelDetails">
          <div class="infoToggle">
            <h4 class="title">Info</h4>
            <span class="icon"></span>
          </div>
          <div class="holder">
            <section class="meta">
              <p class="address">
                <span class="title">Address:</span>
                <span class="data">vera@buddycloud.com</span>
              </p>
              <p class="open">
                <span class="title">This Channel is:</span>
    <span class="data accessModel" data-editmode="boolean">Public</span>
              </p>
              <p class="broadcast">
                <span class="title">Broadcasting for:</span>
    <time class="data"
          datetime="2011-06-06T05:06:00.000Z"
          title="5:06pm 06.06.2011"
          data-strftime="%f"
          data-strftitle="%A %d %B %Y %H:%M">188 days</time>
              </p>
            </section>
            <section class="channelList">
              <h3>moderators <span class="count">1</count></h3>
              <div class="list">
                <img src="avatars/user2.jpg" />
              </div>
            </section><!-- /followers -->
            <section class="channelList">
              <h3>followers <span class="count">20</count></h3>
              <div class="list">
                <img src="avatars/user3.jpg" class="selected" />
                <img src="avatars/user4.jpg" />
                <img src="avatars/user5.jpg" />
                <img src="avatars/user6.jpg" />
                <div class="adminAction first">
                  <div class="arrow"></div>
                  <div class="holder">
                    <div class="box">
                      <section class="channelInfo">
                        <h4>tom@buddycloud.com</h4>
                        <div class="currentRole">Follower</div>
                      </section>
                      <section class="action changeRole">
                        <h5>Change Role</h5>
                        <select>
                          <option value="moderator">Moderator</option>
                          <option value="followerPlus">Follower+Post</option>
                          <option value="follower" selected>Follower</option>
                        </select>
                        <section class="info">
                          <div class="moderator">
                            <ul>
                              <li>read your channel</li>
                              <li>write comments &amp; messages</li>
                              <li>post new topics</li>
                              <li>approve new followers</li>
                              <li>set user's roles</li>
                              <li>delete posts</li>
                            </ul>
                          </div>
                          <div class="followerPlus">
                            <ul>
                              <li>read your channel</li>
                              <li>write comments &amp; messages</li>
                              <li>post new topics</li>
                            </ul>
                          </div>
                          <div class="follower">
                            <ul>
                              <li>read your channel</li>
                            </ul>
                          </div>
                        </section>
                      </section>
                      <section class="action banUser">
                        <h5>Ban User</h5>
                        <div class="info">
                          <ul>
                            <li class="negative">Remove access to channel.</li>
                          </ul>
                        </div>
                      </section>
                      <section class="actionRow choose">
                        <div class="changeRoleButton">Change Role</div>
                        <div class="banUserButton">Ban User</div>
                      </section>
                      <section class="actionRow confirm">
                        <div class="cancelButton">Cancel</div>
                        <div class="okButton">Ok</div>
                      </section>
                    </div><!-- /box -->
                  </div>
                </div>
                <img src="avatars/user7.jpg" />
                <img src="avatars/user8.jpg" />
                <img src="avatars/user9.jpg" />
                <img src="avatars/user10.jpg" />
                <img src="avatars/user11.jpg" />
                <img src="avatars/user12.jpg" />
                <img src="avatars/user13.jpg" />
                <img src="avatars/channel8.jpg" />
              </div>
              <div class="showAll">show all</div>
            </section><!-- /followers -->
            <section class="channelList">
              <h3>channels nearby <span class="count">10</count></h3>
              <div class="list">
                <img src="avatars/channel1.jpg" />
                <img src="avatars/channel2.jpg" />
                <img src="avatars/channel3.jpg" />
                <img src="avatars/channel4.jpg" />
              </div>
              <div class="showAll">show all</div>
            </section><!-- /followers -->
            <section class="channelList">
              <h3>similar channels <span class="count">8</count></h3>
              <div class="list">
                <img src="avatars/channel5.jpg" />
                <img src="avatars/channel6.jpg" />
                <img src="avatars/channel7.jpg" />
                <img src="avatars/channel8.jpg" />
              </div>
              <div class="showAll">show all</div>
            </section><!-- /followers -->
          </div><!-- /holder -->
        </div><!-- /detail -->
      </div>
    </div><!-- /channelView -->
  </div><!-- /content -->
<script type="text/javascript">
  /* ###

  redraw function to make sure that transitions are triggered

  ### */
  !function(document){

      // (C) WebReflection (As It Is) - Mit Style

      // we all love function declarations
      function redraw() {

          // clientHeight returns 0 if not present in the DOM
          // e.g. document.removeChild(document.documentElement);
          // also some crazy guy may swap runtime the whole HTML element
          // this is why the documentElement should be always discovered
          // and if present, it should be a node of the document
          // In all these cases the returned value is true
          // otherwise what is there cannot really be considered as painted

          return !!(document.documentElement || 0).clientHeight;
      }

      // ideally an Object.defineProperty
      // unfortunately some engine will complain
      // if used against DOM objects
      document.redraw = redraw;

  }(document);

  /* ###

    Channel bubbling

    ### */
  var channelHolder = $('.channels');
  var innerHolder = channelHolder.find('.scrollHolder');
  var channels = channelHolder.find('.channel:not(".personal")');

  // prefixes for cutting edge css properties and javascript events:
  //
  //  transition => MozTransition
  var transition = Modernizr.prefixed('transition');
  //  transform => MozTransform
  var transform = Modernizr.prefixed('transform');
  var transEndEventNames = {
      'WebkitTransition' : 'webkitTransitionEnd',
      'MozTransition'    : 'transitionend',
      'OTransition'      : 'oTransitionEnd',
      'msTransition'     : 'msTransitionEnd', // maybe?
      'transition'       : 'transitionEnd'
  }
  //  transitionendEvent => transitionend
  var transitionendEvent = transEndEventNames[ transition ];
  // cache channelHeight - it's the same for every channel-preview
  var channelHeight = channels.first().outerHeight();
  // count of currently moving channels
  var movingChannels = 0;

  /*

  Stress test:

  $('.channel:not(".personal")').each(function(i, channel){
      setTimeout( function(){ $(this).click() }.bind(this), i*250);
  });

  Reality test:

  $('.channel:not(".personal")').each(function(i, channel){
      setTimeout( function(){ $(this).click() }.bind(this), i*Math.round(Math.random()*2500));
  });

  An even more real test:

  time = 5000;

  function goCrazy(){
  var allChannels = $('.channel:not(".personal")');
  allChannels.eq( Math.round( Math.random()*allChannels.size() ) ).click();
    timer = setTimeout(goCrazy, Math.random()*time);
  }
  goCrazy();

  */

  function bubble(){
    var bubblingChannel = $(this);

    // relative offset + absolute offset
    var offset = bubblingChannel.position().top + innerHolder.scrollTop();

    // don't bubble if the channel is..
    //  - on top
    //  - bubbling
    if(offset === 0 || bubblingChannel.parent().hasClass('bubbleHolder')) {
      return false;
    }

    // create a gap where the channel starts off
    var startingArea = $('<div>').height( channelHeight ).addClass('startingArea');
    bubblingChannel.before( startingArea );

    document.redraw();

    startingArea.bind(transitionendEvent, destroy);

    // close startingArea
    startingArea.css('height', 0);

    // detach the bubbling channel from the DOM
    // and insert it at the top
    bubblingChannel.detach().css('top', offset);
    innerHolder.prepend(bubblingChannel);

    // wrap a growing holder around it
    var landingArea = $('<div>').addClass('bubbleHolder');
    bubblingChannel.wrap(landingArea);

    document.redraw();

    // bind the callback on transition end for all bubbling channels
    bubblingChannel.bind(transitionendEvent, reset);

    // bubble!
    bubblingChannel.addClass('bubbling').css({ 'top' : 0, 'z-index' : ++movingChannels+1 });
    // open a gap for the channel to arrive
    bubblingChannel.parent().css('height', channelHeight);
  }

  function destroy(event){
    var propertyToWaitFor = event.data.propertyName;
    if(propertyToWaitFor !== undefined && event.originalEvent.propertyName === propertyToWaitFor)
      $(this).remove();
  }

  function reset(event){
    if(event.data && event.data.callback) event.data.callback();
    // reset the bubbling channel and unwrap it
    $(this).removeClass('bubbling').css({ 'height' : '', 'z-index' : '' }).unwrap();
    movingChannels--;
  }
  channels.click(bubble);
  //channels.toggle(function(){ $(this).css('background', 'red'); }, function(){ $(this).css('background', 'green'); });

  /* ###

    show/hide channel info

    ### */
  var channelInfo = $('.channelDetails');
  var channelInfoToggle = channelInfo.find('> .infoToggle');

  channelInfoToggle.click(function(){ channelInfo.toggleClass('hidden'); });

  $('.showAll').click(function(){
    var list = $(this).prev();
    list.children().clone().appendTo(list);
    $(this).remove();
  });

  /* ###

    new topic animation

    ### */

  $('.opener, .comment').each(function () {
    var post = $(this);
    post.find('button.delete').click(function () {
      post.toggleClass('dangerZone');
    });
  });

  // works for both new topic field and all the small answer fields
  var newTopic = $('.newTopic, .answer');
  var topicTextarea = newTopic.find('textarea');

  function openArea(event){
    // prevent bubbling!
    event.stopPropagation();
    if(!$(this).hasClass('write')){
      $(this).addClass('write');
      $(document).one('click', {self: this}, closeArea);
    }
  }

  function closeArea(event){
    var self = event.data.self;
    var textarea = $(self).find('textarea');
    // minimize the textarea only if the textarea is empty
    if(textarea.val() === ""){
      $(self).removeClass('write');
    }
  }

  newTopic.click(openArea);

  /* ###

    notification animation

    ### */

  var notification = $('.notification');
  var notificationButtons = notification.find('.controls > div');

  function notify(){
    notification.addClass('visible');
  }

  function logNotifaction(){
    var reaction = $(this).hasClass('positive') ? 'granted' : 'denied';
    notification.addClass('log '+reaction);
  }

  notificationButtons.click(logNotifaction);
  //setTimeout('notify()', 2000);

  $(function () {
      //$('#channels').antiscroll();
  });//*/

  /* ###

      edit mode

  */

  var editableElements = [
    'header .title',
    'header .status',
    '.meta .description',
    '.meta .accessModel',
    '.location .previous',
    '.location .current',
    '.location .next'
  ];

  function fauxLoadEditedStuff(){
    for(var i = 0, l = editableElements.length; i < l; i++){
      var el = editableElements[i];
      if($(el).data('editmode') !== 'boolean') {
        if(localStorage[el]) $(el).text( localStorage[el] );
      }
    }
  }

  fauxLoadEditedStuff();

  $('.edit.button').click(function(){
    if(!$('html').hasClass('editmode')){
      $('html').addClass('editmode');
      startEditMode();
    } else {
      $('html').removeClass('editmode');
      stopEditMode(true);
    }
  });

  function startEditMode(){
    for(var i = 0, l = editableElements.length; i < l; i++){
      var el = editableElements[i];
      if($(el).data('editmode') !== 'boolean') {
        // store the current state
        localStorage[el] = $(el).text();

        // add designMode & contenteditable
        $(el)
          .prop('contenteditable', true)
          .input(function(){
            var text = $(this).text();
            if(text === "") $(this).html("&nbsp;");
          }).keydown(function (ev) {
            var code = ev.keyCode || ev.which;
            if ($(this).data('editmode') === 'singleLine' && code == 13) {
                ev.preventDefault();
                return false;
            } else return true;
          });
        // only allow enter when the target is not singleLine
      }
    }
    $(editableElements[0]).focus();
  }

  function stopEditMode(save){
    for(var i = 0, l = editableElements.length; i < l; i++){
      var el = editableElements[i];
      if($(el).data('editmode') !== 'boolean') {

        // remove designMode & contenteditable
        $(el).prop('contenteditable', false);

        // compare the current state with the pre-edit state and store the changed elements
        if($(el).text() != localStorage[el]){
          if(save){
              localStorage[el] = $(el).text();
          } else {
            $(el).text( localStorage[el] );
          }
        }
      }
    }
  }


  /* ###

      search

  ### */

  $('input[type=search]').bind('input', search);
  // channels = $('#channels .channel');

  function search(){
    var text = this.value;
    channels.each(function(i, el){
      // check if the text is in there
      // add class hidden if text is not the same
      if($(el).text().indexOf(text) !== -1){
        $(el).removeClass('hidden');
      } else {
        $(el).addClass('hidden');
      };
    });
  }

  /* ###

    unfollow

    ### */

  $('.inChannel').on('click', '.unfollow', function(){
    // rename button
    $(this).text('Follow').removeClass('unfollow').addClass('follow');

    var channelToRemove = $('.channel.selected');
    channelToRemove.bind(transitionendEvent, { propertyName : 'height' }, destroy);

    document.redraw();

    channelToRemove.addClass('remove');
  });

  /* ###

    follow

    ### */

  function channelTemplate(avatarUrl, owner, status, animationClassName){
    return $('<div class="channel">')
      .addClass(animationClassName ? animationClassName : "")
      .append(
        $('<div class="avatar">').css('background-image', avatarUrl)
      )
      .append(
        $('<div class="info">')
          .append(
            $('<div class="owner">').text(owner)
          )
          .append(
            $('<div class="status">').text(status)
          )
      );
  }

  $('.inChannel').on('click', '.follow', follow);

  function follow(){
    // TODO: scroll channel list up (animation) and the go on
    $(this).text('Unfollow').removeClass('follow').addClass('unfollow');

    var avatarUrl = $(this).parent().siblings('.avatar').css('background-image');
    var owner = $(this).parent().siblings().children('.owner').text();
    // the status will not be visible in the discovery
    // using the about for now
    var status = $(this).parent().siblings().children('.about').text();
    var animationClassName = 'channelHeader';
    console.log(avatarUrl);
    console.log(owner);
    console.log(status);
    // create new channel from template for the sidebar
    var newChannel = new channelTemplate(avatarUrl, owner, status, animationClassName);

    // get the start offset
    var offset = $(this).parents('.channelHeader').offset();
    var callback = function(){
      $('.channels').removeClass('rainbowAnimationRunning');
      $(this).addClass('selected').css({ left: '', top: '' });
    }.bind(newChannel);

    $('.channels').addClass('rainbowAnimationRunning');

    // start the animation
    rainbowAnimation(newChannel, offset, animationClassName, callback);
  }

  function rainbowAnimation(channel, offset, animationClassName, callback){
    channel.css({
      left : offset.left - innerHolder.offset().left,
      top : offset.top - innerHolder.offset().top
    });
    innerHolder.prepend(channel);

    // wrap a growing holder around it
    var landingArea = $('<div>').addClass('bubbleHolder rainbowBubble');
    channel.wrap(landingArea);

    document.redraw();

    console.log(channel);
    // bind the callback on transition end for all bubbling channels
    channel.one(transitionendEvent, { callback : callback }, reset);
    // bubble!
    channel.removeClass(animationClassName).css({ 'top' : 0, 'left' : 0, 'z-index' : ++movingChannels+1 });
    // open a gap for the channel to arrive
    channel.parent().css('height', channelHeight);
  }

  /* ###

    Show Settings

    ### */
  $('.settings').click(function(){
    $(this).toggleClass('showSettings');
  });
  $('.settings li').click(function(event){
    event.stopPropagation();
  });
</script>
</body>
</html>
