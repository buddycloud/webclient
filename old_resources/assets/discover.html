<!doctype html>
<html lang="en">
<head>
  <title>buddycloud Discover</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="web/css/main.css" type="text/css" media="screen">
  <script type="text/javascript" src="config.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="web/js/app.js"></script>
  <script src="web/js/livecss.js"></script>
</head>
<body>
  <div id="editbar">
      <h2>Edit Mode</h2>
      <!--
        we could place a history of all changes here
        with (x)'s next to them to undo said step
        clicking and hovering on the change note highlights the node
      -->
    <div class="edits">
      <div class="contenteditable">
	<input id="allowPost" type="checkbox">
	<label for="allowPost">New followers can post</label>
      </div>
      <!--div class="contenteditable">
	<select id="channel_publish">
	  <option value="open">Anyone</option>
	  <option value="subscribers">Followers</option>
	  <option value="moderators">Moderators</option>
	</select>
        <label for="channel_publish">can post</label>
      </div-->
      <!--div class="contenteditable">
        <label for="userEmail">Email</label>
        <input id="userEmail" type="email" value="vera<span class="domain">@buddycloud.com</span>" placeholder="Email Adress">
      </div-->
    </div>
    <div class="dangerZone">
      <h3>Delete Channel</h3>
      <p>
        Once you delete the channel there is no going back. Please be certain.
      </p>
      <div class="button danger delete">Delete Channel</div>
    </div>
  </div>
  <div class="sidebar">
    <div class="personal channel">
      <div class="avatar" style="background-image: url(public/avatars/user1.jpg)">
        <span class="channelpost counter">2</span>
        <span class="message counter">2</span>
      </div>
      <div class="info">
        <span class="owner">felix<span class="domain">@buddycloud.com</span></span>
        <span class="status">Aww yeah, Lion rocks</span>
      </div>
      <nav>
        <button class="logout">Logout</button>
      </nav>
    </div>
    <nav class="actionBar clearfix">
      <button class="discover active"><span>Discover New Channels</span></button>
    </nav>
    <div class="search">
      <input type="search" results="5" autosave="channelSearch" placeholder="Search Channels ..." />
    </div>
    <div id="channels" class="antiscroll-wrap">
      <div class="antiscroll-inner scrollHolder">
        <div class="channel selected">
          <div class="avatar" style="background-image: url(public/avatars/user2.jpg)">
            <span class="channelpost counter">2</span>
          </div>
          <div class="info">
            <span class="owner">vera<span class="domain">@buddycloud.com</span></span>
            <span class="status">What a wonderful day</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(public/avatars/channel2.jpg)">
            <span class="channelpost counter admin">1</span>
          </div>
          <div class="info">
            <span class="owner">moviefans<span class="domain">@buddycloud.com</span></span>
            <span class="status">Harry Potter, tonight!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(public/avatars/channel3.jpg)">
            <span class="channelpost counter admin">1</span>
          </div>
          <div class="info">
            <span class="owner">on-the-box<span class="domain">@bbc.co.uk</span></span>
            <span class="status">You gonna love the new Dexter episodes</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(public/avatars/topic.png)">
            <span class="channelpost counter">2</span>
          </div>
          <div class="info">
            <span class="owner">lolcats<span class="domain">@buddycloud.com</span></span>
            <span class="status">I can haz your nose?</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(public/avatars/user4.jpg)">
          </div>
          <div class="info">
            <span class="owner">martin<span class="domain">@buddycloud.com</span></span>
            <span class="status">working on the webgl project</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(public/avatars/topic.png)">
          </div>
          <div class="info">
            <span class="owner">music<span class="domain">@buddycloud.com</span></span>
            <span class="status">New Foo Fighter Album online - check it out!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(public/avatars/user7.jpg)">
          </div>
          <div class="info">
            <span class="owner">verena<span class="domain">@buddycloud.com</span></span>
            <span class="status">test's are over - party!!!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(public/avatars/channel7.jpg)">
          </div>
          <div class="info">
            <span class="owner">fans<span class="domain">@steam.com</span></span>
            <span class="status">the cake is a lie!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(public/avatars/channel8.jpg)">
          </div>
          <div class="info">
            <span class="owner">cave<span class="domain">@minecraft.com</span></span>
            <span class="status">Buy minecraft - now!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(public/avatars/anon.png)">
            <span class="channelpost counter">2</span>
          </div>
          <div class="info">
            <span class="owner">steve<span class="domain">@buddycloud.com</span></span>
            <span class="status">all your base belongs to us</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(public/avatars/channel2.jpg)">
            <span class="channelpost counter admin">1</span>
          </div>
          <div class="info">
            <span class="owner">moviefans<span class="domain">@buddycloud.com</span></span>
            <span class="status">Harry Potter, tonight!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(public/avatars/channel3.jpg)">
            <span class="channelpost counter admin">1</span>
          </div>
          <div class="info">
            <span class="owner">on-the-box<span class="domain">@bbc.co.uk</span></span>
            <span class="status">You gonna love the new Dexter episodes</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(public/avatars/channel4.jpg)">
            <span class="channelpost counter">2</span>
          </div>
          <div class="info">
            <span class="owner">lolcats<span class="domain">@buddycloud.com</span></span>
            <span class="status">I can haz your nose?</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(public/avatars/user4.jpg)">
          </div>
          <div class="info">
            <span class="owner">martin<span class="domain">@buddycloud.com</span></span>
            <span class="status">working on the webgl project</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(public/avatars/channel6.jpg)">
          </div>
          <div class="info">
            <span class="owner">music<span class="domain">@buddycloud.com</span></span>
            <span class="status">New Foo Fighter Album online - check it out!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(public/avatars/user7.jpg)">
          </div>
          <div class="info">
            <span class="owner">verena<span class="domain">@buddycloud.com</span></span>
            <span class="status">test's are over - party!!!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(public/avatars/channel7.jpg)">
          </div>
          <div class="info">
            <span class="owner">fans<span class="domain">@steam.com</span></span>
            <span class="status">the cake is a lie!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(public/avatars/channel8.jpg)">
          </div>
          <div class="info">
            <span class="owner">cave<span class="domain">@minecraft.com</span></span>
            <span class="status">Buy minecraft - now!</span>
          </div>
        </div>
      </div><!-- /antiscroll-inner -->
    </div><!-- /channels -->
    <button id="create_topic_channel"><span>Create Topic Channel</span></button>
  </div>
  <div class="content">
      <div class="discoverChannels">
        <div class="local span-2">
          <h1>Local</h1>
          <div class="mostActive span-1">
            <h2>Most Active</h2>
            <div class="list">
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user12.jpg)"></div>
                <div class="info">
                  <span class="owner">franz<span class="domain">@buddycloud.com</span></span>
                  <span class="status">Hanging out at starbucks</span>
                </div>
              </div>
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user11.jpg)"></div>
                <div class="info">
                  <span class="owner">lisa<span class="domain">@buddycloud.com</span></span>
                  <span class="status">Where is the love?</span>
                </div>
              </div>
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user13.jpg)"></div>
                <div class="info">
                  <span class="owner">ralf<span class="domain">@buddycloud.com</span></span>
                  <span class="status">Ich bin ein Berliner!</span>
                </div>
              </div>
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user6.jpg)"></div>
                <div class="info">
                  <span class="owner">steffi<span class="domain">@buddycloud.com</span></span>
                  <span class="status">Listening to Fuadadeimuada</span>
                </div>
              </div>
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user7.jpg)"></div>
                <div class="info">
                  <span class="owner">anna<span class="domain">@buddycloud.com</span></span>
                  <span class="status">First Season of Game of Thrones was a blast!</span>
                </div>
              </div>
            </div>
          </div>
          <div class="popular span-1">
            <h2>Popular</h2>
            <div class="list">
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user1.jpg)"></div>
                <div class="info">
                  <span class="owner">mrflix<span class="domain">@buddycloud.com</span></span>
                  <span class="status">I don't like cinema</span>
                </div>
              </div>
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user4.jpg)"></div>
                <div class="info">
                  <span class="owner">martin<span class="domain">@buddycloud.com</span></span>
                  <span class="status">Handed in my thesis. Like a boss.</span>
                </div>
              </div>
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user2.jpg)"></div>
                <div class="info">
                  <span class="owner">vera<span class="domain">@buddycloud.com</span></span>
                  <span class="status">Munich here I come.</span>
                </div>
              </div>
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user3.jpg)"></div>
                <div class="info">
                  <span class="owner">tom<span class="domain">@buddycloud.com</span></span>
                  <span class="status">Island is great. Let's make music</span>
                </div>
              </div>
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user5.jpg)"></div>
                <div class="info">
                  <span class="owner">josef<span class="domain">@buddycloud.com</span></span>
                  <span class="status">Desmond Myers really knows how to rap</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="global span-2">
          <h1>Global</h1>
          <div class="mostActive span-1">
            <h2>Most Active</h2>
            <div class="list">
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user12.jpg)"></div>
                <div class="info">
                  <span class="owner">franz<span class="domain">@buddycloud.com</span></span>
                  <span class="status">Hanging out at starbucks</span>
                </div>
              </div>
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user11.jpg)"></div>
                <div class="info">
                  <span class="owner">lisa<span class="domain">@buddycloud.com</span></span>
                  <span class="status">Where is the love?</span>
                </div>
              </div>
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user13.jpg)"></div>
                <div class="info">
                  <span class="owner">ralf<span class="domain">@buddycloud.com</span></span>
                  <span class="status">Ich bin ein Berliner!</span>
                </div>
              </div>
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user6.jpg)"></div>
                <div class="info">
                  <span class="owner">steffi<span class="domain">@buddycloud.com</span></span>
                  <span class="status">Listening to Fuadadeimuada</span>
                </div>
              </div>
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user7.jpg)"></div>
                <div class="info">
                  <span class="owner">anna<span class="domain">@buddycloud.com</span></span>
                  <span class="status">First Season of Game of Thrones was a blast!</span>
                </div>
              </div>
            </div>
          </div>
          <div class="popular span-1">
            <h2>Popular</h2>
            <div class="list">
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user1.jpg)"></div>
                <div class="info">
                  <span class="owner">mrflix<span class="domain">@buddycloud.com</span></span>
                  <span class="status">I don't like cinema</span>
                </div>
              </div>
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user4.jpg)"></div>
                <div class="info">
                  <span class="owner">martin<span class="domain">@buddycloud.com</span></span>
                  <span class="status">Handed in my thesis. Like a boss.</span>
                </div>
              </div>
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user2.jpg)"></div>
                <div class="info">
                  <span class="owner">vera<span class="domain">@buddycloud.com</span></span>
                  <span class="status">Munich here I come.</span>
                </div>
              </div>
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user3.jpg)"></div>
                <div class="info">
                  <span class="owner">tom<span class="domain">@buddycloud.com</span></span>
                  <span class="status">Island is great. Let's make music</span>
                </div>
              </div>
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user5.jpg)"></div>
                <div class="info">
                  <span class="owner">josef<span class="domain">@buddycloud.com</span></span>
                  <span class="status">Desmond Myers really knows how to rap</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="location span-1">
          <h1>Location</h1>
          <div class="nearby span-1">
            <h2>Nearby</h2>
            <div class="list">
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user1.jpg)"></div>
                <div class="info">
                  <span class="owner">mrflix<span class="domain">@buddycloud.com</span></span>
                  <span class="status">I don't like cinema</span>
                </div>
              </div>
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user4.jpg)"></div>
                <div class="info">
                  <span class="owner">martin<span class="domain">@buddycloud.com</span></span>
                  <span class="status">Handed in my thesis. Like a boss.</span>
                </div>
              </div>
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user2.jpg)"></div>
                <div class="info">
                  <span class="owner">vera<span class="domain">@buddycloud.com</span></span>
                  <span class="status">Munich here I come.</span>
                </div>
              </div>
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user3.jpg)"></div>
                <div class="info">
                  <span class="owner">tom<span class="domain">@buddycloud.com</span></span>
                  <span class="status">Island is great. Let's make music</span>
                </div>
              </div>
              <div class="channel">
                <div class="avatar" style="background-image: url(public/avatars/user5.jpg)"></div>
                <div class="info">
                  <span class="owner">josef<span class="domain">@buddycloud.com</span></span>
                  <span class="status">Desmond Myers really knows how to rap</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
  </div><!-- /content -->
<script type="text/javascript">
  /* ###
  
  redraw function to make sure that transitions are triggered 
  
  ### */
  !function(document){

      // (C) WebReflection (As It Is) - Mit Style

      // we all love function declarations
      function redraw() {

          // clientHeight returns 0 if not present in the DOM
          // e.g. document.removeChild(document.documentElement);
          // also some crazy guy may swap runtime the whole HTML element
          // this is why the documentElement should be always discovered
          // and if present, it should be a node of the document
          // In all these cases the returned value is true
          // otherwise what is there cannot really be considered as painted

          return !!(document.documentElement || 0).clientHeight;
      }

      // ideally an Object.defineProperty
      // unfortunately some engine will complain
      // if used against DOM objects
      document.redraw = redraw;

  }(document);
  
  /* ###
  
    Channel bubbling
  
    ### */
  var channelHolder = $('#channels');
  var innerHolder = channelHolder.find('.scrollHolder');
  var channels = channelHolder.find('.channel:not(".personal")');
  
  // prefixes for cutting edge css properties and javascript events:
  //
  //  transition => MozTransition
  var transition = Modernizr.prefixed('transition');
  //  transform => MozTransform
  var transform = Modernizr.prefixed('transform');
  var transEndEventNames = {
      'WebkitTransition' : 'webkitTransitionEnd',
      'MozTransition'    : 'transitionend',
      'OTransition'      : 'oTransitionEnd',
      'msTransition'     : 'msTransitionEnd', // maybe?
      'transition'       : 'transitionEnd'
  }
  //  transitionendEvent => transitionend
  var transitionendEvent = transEndEventNames[ transition ];
  // cache channelHeight - it's the same for every channel-preview
  var channelHeight = channels.first().outerHeight();
  // count of currently moving channels
  var movingChannels = 0;
  
  /*
  
  Stress test:
  
  $('.channel:not(".personal")').each(function(i, channel){
      setTimeout( function(){ $(this).click() }.bind(this), i*250);
  });
  
  Reality test:
  
  $('.channel:not(".personal")').each(function(i, channel){
      setTimeout( function(){ $(this).click() }.bind(this), i*Math.round(Math.random()*2500));
  });
  
  An even more real test:
  
  time = 5000;
  
  function goCrazy(){
  var allChannels = $('.channel:not(".personal")');
  allChannels.eq( Math.round( Math.random()*allChannels.size() ) ).click();
    timer = setTimeout(goCrazy, Math.random()*time);
  }
  goCrazy();
  
  */
  
  function bubble(){
    var bubblingChannel = $(this);
    
    // relative offset + absolute offset 
    var offset = bubblingChannel.position().top + innerHolder.scrollTop();
    
    // don't bubble if the channel is..
    //  - on top
    //  - bubbling
    if(offset === 0 || bubblingChannel.parent().hasClass('bubbleHolder')) {
      return false;
    }
    
    // create a gap where the channel starts off
    var startingArea = $('<div>').height( channelHeight ).addClass('startingArea');
    bubblingChannel.before( startingArea );
    
    document.redraw();
    
    startingArea.bind(transitionendEvent, destroy);
    
    // close startingArea
    startingArea.css('height', 0);
    
    // detach the bubbling channel from the DOM
    // and insert it at the top
    bubblingChannel.detach().css('top', offset);
    innerHolder.prepend(bubblingChannel);
    
    // wrap a growing holder around it
    var landingArea = $('<div>').addClass('bubbleHolder');
    bubblingChannel.wrap(landingArea);
    
    document.redraw();
    
    // bind the callback on transition end for all bubbling channels
    bubblingChannel.bind(transitionendEvent, reset);
    
    // bubble!
    bubblingChannel.addClass('bubbling').css({ 'top' : 0, 'z-index' : ++movingChannels+1 });
    // open a gap for the channel to arrive
    bubblingChannel.parent().css('height', channelHeight);
  }
  
  function destroy(){
    // remove the gap-div
    $(this).remove();
  }
  
  function reset(){
    // reset the bubbling channel and unwrap it
    $(this).removeClass('bubbling').css({ 'height' : '', 'z-index' : '' }).unwrap();
    movingChannels--;
  }
  
  channels.click(bubble);
  //channels.toggle(function(){ $(this).css('background', 'red'); }, function(){ $(this).css('background', 'green'); });
  
  /* ###
    
    show/hide channel info
    
    ### */
  var channelInfo = $('.channelDetails');  
  var channelInfoToggle = channelInfo.find('> .infoToggle');
  
  channelInfoToggle.click(function(){ channelInfo.toggleClass('hidden'); });
  
  $('.showAll').click(function(){
    var list = $(this).prev();
    list.children().clone().appendTo(list);
    $(this).remove();
  });
  
  /* ###
    
    new topic animation
    
    ### */
  
  // works for both new topic field and all the small answer fields
  var newTopic = $('.newTopic, .answer');
  var topicTextarea = newTopic.find('textarea');
  
  function openArea(event){
    // prevent bubbling!
    event.stopPropagation();
    if(!$(this).hasClass('write')){
      $(this).addClass('write');
      $(document).one('click', {self: this}, closeArea);
    }
  }
  
  function closeArea(event){
    var self = event.data.self;
    var textarea = $(self).find('textarea');
    // minimize the textarea only if the textarea is empty
    if(textarea.val() === ""){
      $(self).removeClass('write');
    }
  }
  
  newTopic.click(openArea);
  
  /* ###
    
    notification animation

    ### */
  var notification = $('.notification');
  var notificationButtons = notification.find('.controls > div');
  
  function notify(){
    notification.addClass('visible');
  }
  
  function logNotifaction(){
    var reaction = $(this).hasClass('positive') ? 'granted' : 'denied';
    notification.addClass('log '+reaction);
  }
  
  notificationButtons.click(logNotifaction);
  setTimeout('notify()', 2000);
  
  $(function () {
      $('#channels').antiscroll();
  });//*/
  
  /* ###
  
      edit mode
      
  */
  
  var editableElements = [ 
    'header .title',
    'header .status',
    '.meta .description',
    '.meta .accessModel',
    '.location .previous',
    '.location .current',
    '.location .next'
  ];
  
  function fauxLoadEditedStuff(){
    for(var i = 0, l = editableElements.length; i < l; i++){
      var el = editableElements[i];
      if($(el).data('editmode') !== 'boolean') {
        if(localStorage[el]) $(el).text( localStorage[el] );
      }
    }
  }
  
  fauxLoadEditedStuff();
  
  $('.edit.button').click(function(){
    if(!$('html').hasClass('editmode')){
      $('html').addClass('editmode');
      startEditMode();
    } else {
      $('html').removeClass('editmode');
      stopEditMode(false);
    }
  });
  $('#editbar .save').click(function(){ $('html').removeClass('editmode'); stopEditMode(true); });
  $('#editbar .cancel').click(function(){ $('html').removeClass('editmode'); stopEditMode(false); });

  function startEditMode(){
    for(var i = 0, l = editableElements.length; i < l; i++){
      var el = editableElements[i];
      if($(el).data('editmode') !== 'boolean') {
        // store the current state
        localStorage[el] = $(el).text();

        // add designMode & contenteditable
        $(el)
          .prop('contenteditable', true)
          .input(function(){
            var text = $(this).text();
            if(text === "") $(this).html("&nbsp;");
          }).keydown(function (ev) {
            var code = ev.keyCode || ev.which;
            if ($(this).data('editmode') === 'singleLine' && code == 13) {
                ev.preventDefault();
                return false;
            } else return true;
          });
        // only allow enter when the target is not singleLine
      }
    }
    $(editableElements[0]).focus();
  }

  function stopEditMode(save){
    for(var i = 0, l = editableElements.length; i < l; i++){
      var el = editableElements[i];
      if($(el).data('editmode') !== 'boolean') {

        // remove designMode & contenteditable
        $(el).prop('contenteditable', false);

        // compare the current state with the pre-edit state and store the changed elements
        if($(el).text() != localStorage[el]){
          if(save){
              localStorage[el] = $(el).text();
          } else {
            $(el).text( localStorage[el] );
          }
        }
      }
    }
  }
  
  
  /* ###
  
      search
      
  ### */
  
  $('input[type=search]').bind('input', search);
  // channels = $('#channels .channel');
  
  function search(){
    var text = this.value;
    channels.each(function(i, el){
      // check if the text is in there
      // add class hidden if text is not the same
      if($(el).text().indexOf(text) !== -1){
        $(el).removeClass('hidden');
      } else {
        $(el).addClass('hidden');
      };
    });
  }
</script>
</body>
</html>
